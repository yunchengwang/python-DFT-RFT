{
 "cells": [
  {
   "cell_type": "code",
   "execution_count": 1,
   "metadata": {},
   "outputs": [],
   "source": [
    "import os\n",
    "import pickle\n",
    "import numpy as np\n",
    "import matplotlib.pyplot as plt\n",
    "from sklearn.decomposition import PCA"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 2,
   "metadata": {},
   "outputs": [],
   "source": [
    "## Relevant feature test\n",
    "\n",
    "def plot_mos_density(features, dim, mos, bins=32, metric='mse'):\n",
    "    density_map = np.zeros((100, bins))\n",
    "    mos = np.floor(mos).astype(int)\n",
    "    f_1d = features[:, dim]\n",
    "    f_1d, mos = remove_outliers(f_1d, mos)\n",
    "    f_min, f_max = f_1d.min(), f_1d.max()\n",
    "    bin_width = (f_max - f_min) / bins\n",
    "    for i in range(len(mos)):\n",
    "        density_map[mos[i], np.floor((f_1d[i] - f_min - 0.0001)/bin_width).astype(int)] += 1\n",
    "        \n",
    "    best_error, best_partition_index, l_mean, r_mean = find_best_partition(f_1d, mos, bins, metric=metric)\n",
    "    plt.figure()\n",
    "    plt.axvline(x=best_partition_index, color='red', label='partition point')\n",
    "    plt.axhline(y=l_mean, xmin=0, xmax=best_partition_index/bins, color='yellow', label='left mean')\n",
    "    plt.axhline(y=r_mean, xmin=best_partition_index/bins, xmax=1, color='white', label='right mean')\n",
    "    plt.legend()\n",
    "    plt.imshow(density_map)\n",
    "\n",
    "\n",
    "def find_best_partition(f_1d, mos, bins=32, metric='mse'):\n",
    "    f_1d, mos = remove_outliers(f_1d, mos)\n",
    "    best_error = float('inf')\n",
    "    best_partition_index = 0\n",
    "    left_mean, right_mean = 0, 0\n",
    "    f_min, f_max = f_1d.min(), f_1d.max()\n",
    "    bin_width = (f_max - f_min) / bins\n",
    "    for i in range(1, bins):\n",
    "        partition_point = f_min + i * bin_width\n",
    "        left_mos, right_mos = mos[f_1d <= partition_point], mos[f_1d > partition_point]\n",
    "        partition_error = get_partition_error(left_mos, right_mos, metric)\n",
    "        if partition_error < best_error:\n",
    "            best_error = partition_error\n",
    "            best_partition_index = i\n",
    "            left_mean = left_mos.mean()\n",
    "            right_mean = right_mos.mean()\n",
    "    return best_error, best_partition_index, left_mean, right_mean\n",
    "        \n",
    "\n",
    "def get_partition_error(left_mos, right_mos, metric='mse'):\n",
    "    if metric == 'mse':\n",
    "        n1, n2 = len(left_mos), len(right_mos)\n",
    "        left_mse = ((left_mos - left_mos.mean())**2).sum()\n",
    "        right_mse = ((right_mos - right_mos.mean())**2).sum()\n",
    "        return np.sqrt((left_mse + right_mse) / (n1 + n2))\n",
    "    else:\n",
    "        print('Unsupported error')\n",
    "        return 0\n",
    "\n",
    "\n",
    "def remove_outliers(f_1d, mos, n_std=2.0):\n",
    "    # f is a 1D feature\n",
    "    new_f_1d = []\n",
    "    new_mos = []\n",
    "    f_mean, f_std = f_1d.mean(), f_1d.std()\n",
    "    for i in range(len(mos)):\n",
    "        if np.abs(f_1d[i] - f_mean) <= n_std * f_std:\n",
    "            new_f_1d.append(f_1d[i])\n",
    "            new_mos.append(mos[i])\n",
    "    return np.array(new_f_1d), np.array(new_mos)\n",
    "\n",
    "## High-dimensional RFT\n",
    "\n",
    "def find_best_partition_ho(f_ho, mos, bins=32, metric='mse'):\n",
    "    if f_ho.shape[1] == 1:\n",
    "        f_1d = f_ho.reshape(-1)\n",
    "    else:\n",
    "        pca = PCA(n_components=1)\n",
    "        f_1d = pca.fit_transform(f_ho).reshape(-1)\n",
    "    f_1d, mos = remove_outliers(f_1d, mos)\n",
    "    best_error = float('inf')\n",
    "    best_partition_index = 0\n",
    "    left_mean, right_mean = 0, 0\n",
    "    f_min, f_max = f_1d.min(), f_1d.max()\n",
    "    bin_width = (f_max - f_min) / bins\n",
    "    for i in range(1, bins):\n",
    "        partition_point = f_min + i * bin_width\n",
    "        left_mos, right_mos = mos[f_1d <= partition_point], mos[f_1d > partition_point]\n",
    "        partition_error = get_partition_error(left_mos, right_mos, metric)\n",
    "        if partition_error < best_error:\n",
    "            best_error = partition_error\n",
    "            best_partition_index = i\n",
    "            left_mean = left_mos.mean()\n",
    "            right_mean = right_mos.mean()\n",
    "    return best_error, best_partition_index, left_mean, right_mean"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": 3,
   "metadata": {},
   "outputs": [
    {
     "data": {
      "image/png": "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\n",
      "text/plain": [
       "<Figure size 432x288 with 1 Axes>"
      ]
     },
     "metadata": {
      "needs_background": "light"
     },
     "output_type": "display_data"
    },
    {
     "name": "stdout",
     "output_type": "stream",
     "text": [
      "(1000, 20)\n"
     ]
    }
   ],
   "source": [
    "## Synthetic datasets: 1000 samples, 100 features; labels is uniform distributed in [1, 5]\n",
    "### train RFT\n",
    "X = np.random.randn(1000, 100)\n",
    "y = np.random.uniform(1, 5, 1000)\n",
    "\n",
    "dim_mse = dict()\n",
    "for d in range(X.shape[1]):\n",
    "    best_mse, _, _, _ = find_best_partition(X[:, d], y, bins=32)\n",
    "    dim_mse[d] = best_mse\n",
    "    \n",
    "sorted_mse = {k: v for k, v in sorted(dim_mse.items(), key=lambda item: item[1])}\n",
    "\n",
    "plt.figure()\n",
    "plt.plot(np.arange(100), list(sorted_mse.values()))\n",
    "plt.xlabel('Rank')\n",
    "plt.ylabel('RMSE')\n",
    "plt.show()\n",
    "\n",
    "### Extract relevant features\n",
    "relevant_dimension = np.array(list(sorted_mse.keys()))[np.arange(20)]\n",
    "selected_X = X[:, relevant_dimension]\n",
    "print(selected_X.shape)"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {},
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "bvqa",
   "language": "python",
   "name": "bvqa"
  },
  "language_info": {
   "codemirror_mode": {
    "name": "ipython",
    "version": 3
   },
   "file_extension": ".py",
   "mimetype": "text/x-python",
   "name": "python",
   "nbconvert_exporter": "python",
   "pygments_lexer": "ipython3",
   "version": "3.7.11"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 4
}
